<!doctype html>
<html class="theme-next use-motion">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>




  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.3.0"/>





    <meta name="keywords" content="Hexo,next" />





    <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.3.0" />




  <title> Hexo </title>
</head>

<body>
  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
    <a href="/" class="brand">
        <span class="logo">
          <i class="icon-logo"></i>
        </span>
        <span class="site-title">Hexo</span>
    </a>
</h1>


  <ul id="menu" class="menu">
    
      
      <li class="menu-item menu-item-home">
        <a href="/">
          <i class="menu-item-icon icon-home"></i> <br />
          首页
        </a>
      </li>
    
      
      <li class="menu-item menu-item-archives">
        <a href="/archives">
          <i class="menu-item-icon icon-archives"></i> <br />
          归档
        </a>
      </li>
    
      
      <li class="menu-item menu-item-tags">
        <a href="/tags">
          <i class="menu-item-icon icon-tags"></i> <br />
          标签
        </a>
      </li>
    
  </ul>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
            
          

          <div id="posts" class="posts-expand">
            
  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/04/14/2013-05-30-ajax1/">
                未命名
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2015-04-14
          
        </span>
        
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <hr>
<p>layout: post<br>title: “AJAX之GET与POST”<br>date: 2013-05-30 19:47<br>comments: true</p>
<h2 id="categories:_JS">categories: JS </h2><h2 id="写在前面">写在前面</h2><p>ajax就是使用异步的方式从服务器获取数据或者向服务器写入数据的技术。它使用户无需刷新整个页面就能从服务器获取数据，并且在发送请求后用户不用傻等还能继续其他操作。    </p>
<p>之前一直用jQuery封装AJAX的各种接口，用的特顺手，后来为了系统学习特意买了本《Head First Ajax》，看了大概5章实在有些受不了了，这本书节奏太慢，感觉是针对完全的js小白。于是，转看《js高级程序设计》了，这本书讲的Ajax相关知识算是比较广的。这部分在练习的时候需要和后台结合才能较深理解Ajax工作机制，在练习过程中遇到了一些问题：后台无法获取参数数据、XHR全局变量问题、readystatechange事件中event对象的问题。详细感悟如下。  </p>
<h2 id="XHR对象">XHR对象</h2><p>XMLHttpRequest对象是ajax的核心，js就是通过XHR对象向服务器发送异步请求并处理响应的。<br><strong>XHR对象的主要属性和事件</strong>  </p>
<ul>
<li>responseText  </li>
<li>responseXML  </li>
<li>readystate    <ul>
<li>0（未初始化），XHR对象已建立，但未初始化（即未调用open方法）</li>
<li>1（初始化），已初始化，但还未发送数据（即未调用send方法）</li>
<li>2（发送数据），已发送数据，响应和http头未知</li>
<li>3（数据接收中），已接收部分数据，响应和http头不全</li>
<li>4（完成），数据接收完毕。</li>
</ul>
</li>
<li>status  <ul>
<li>1xx 信息提示  </li>
<li>2xx 成功</li>
<li>3xx 重定向</li>
<li>4xx 客户端错误</li>
<li>5xx 服务器错误</li>
</ul>
</li>
</ul>
<p><strong>创建XHR对象（跨浏览器兼容）</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">//创建XHR对象 </span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">createXHR</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> XHR;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">           XHR= <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (IE) &#123;</span><br><span class="line">          <span class="keyword">try</span>&#123;</span><br><span class="line">             XHR=<span class="keyword">new</span> ActiveXObject(Msxml.XMLHTTP);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (otherIE) &#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                XHR = <span class="keyword">new</span> ActiveXObject(Microsoft.XMLHTTP);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(faild)&#123;</span><br><span class="line">                XHR=<span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> XHR;</span><br><span class="line">    &#125;  </span><br><span class="line">``` </span><br><span class="line">## get </span><br><span class="line">	  </span><br><span class="line">在有些书上写AJAX示例时，会把创建的XHR对象定义为全局变量，这样做一般是为了在`readystatechange`事件中能访问到该XHR对象。全局变量必然是不推荐的，我试图通过常规的事件绑定做法通过event对象获取当前活动对象target来访问到XHR，如代码一所示，测试发现，代码一在IE以外的浏览器是正常的，在IE下始终无法获取到target。原因是IE浏览器没有为readystatechange事件实现事件对象，为了跨浏览器兼容，建议大家还是直接访问XHR对象本事。    </span><br><span class="line"></span><br><span class="line">为了避免全局变量，可以使用匿名函数立即执行的办法，如代码二，记得将handler的声明放进匿名函数，不然根据作用域链可知还是无法在handler中获取到XHR对象。  </span><br><span class="line">  </span><br><span class="line">代码一  </span><br><span class="line">```javascript</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">hehe</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> request = creatXHR();</span><br><span class="line">        <span class="keyword">if</span> (request == <span class="literal">null</span>) &#123;</span><br><span class="line">            alert(无法创建XHR对象);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      		request.onreadystatechange = handler;</span><br><span class="line">            request.open(<span class="string">"GET"</span>, <span class="string">"./getInfo?encodeURIComponent(name1)=encodeURIComponent(value1)&amp;encodeURIComponent(name2)=encodeURIComponent(value2)"</span>, <span class="literal">true</span>);</span><br><span class="line">            request.send(<span class="literal">null</span>);            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">handler</span><span class="params">(event)</span> </span>&#123;</span><br><span class="line">        event = event ? event : <span class="built_in">window</span>.event;</span><br><span class="line">        <span class="keyword">var</span> target = event.srcElement || event.target;</span><br><span class="line">        <span class="keyword">if</span> (target.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (target.status &gt;= <span class="number">200</span> &amp;&amp; target.status &lt;= <span class="number">300</span> || target.status == <span class="number">304</span>) &#123;</span><br><span class="line">                alert(target.responseText);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">```  </span><br><span class="line">代码二</span><br><span class="line">```javascript</span><br><span class="line">	(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">var</span> request=createXHR();</span><br><span class="line">		<span class="keyword">if</span>(request==<span class="literal">null</span>)&#123;</span><br><span class="line">			alert(<span class="string">"无法创建XHR对象。"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			request.onreadystatechange=handler;</span><br><span class="line">			request.open(<span class="string">"GET"</span>,<span class="string">"./getInfo?encodeURIComponent(name1)=encodeURIComponent(value1)&amp;encodeURIComponent(name2)=encodeURIComponent(value2)"</span>,<span class="literal">true</span>);</span><br><span class="line">			request.send(<span class="literal">null</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">handler</span><span class="params">()</span></span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(request.readyState==<span class="number">4</span>)&#123;</span><br><span class="line">				<span class="keyword">if</span>(request.status&gt;=<span class="number">200</span>&amp;&amp;request.status&lt;<span class="number">300</span>||request.status==<span class="number">304</span>)&#123;</span><br><span class="line">					alert(request.responseText);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;  </span><br><span class="line">    &#125;)();</span><br></pre></td></tr></table></figure></p>
<h3 id="使用get方式需要注意的：">使用get方式需要注意的：</h3><p>参数需要编码：<br>在使用get请求时最常发生的一个错误就是参数格式有问题。每个参数的名值对都要进行encodeURIComponent编码，且所有名值对用’&amp;’分隔。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">//为url添加一个名值对  </span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">addURLPara</span><span class="params">(url,name,value)</span></span>&#123;</span><br><span class="line">		url+=url.indexOf(<span class="string">"?"</span>)==-<span class="number">1</span>?<span class="string">"?"</span>:<span class="string">"&amp;"</span>;</span><br><span class="line">		url+=<span class="built_in">encodeURIComponent</span>(name)+<span class="string">"="</span>+<span class="built_in">encodeURIComponent</span>(value);</span><br><span class="line">		<span class="keyword">return</span> url;</span><br><span class="line">	&#125;  </span><br><span class="line">```	  </span><br><span class="line">## post </span><br><span class="line">```javascript	  </span><br><span class="line">	(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">var</span> request=<span class="keyword">new</span> createXHR();</span><br><span class="line">		request.onreadystatechange=handler;</span><br><span class="line">		request.open(<span class="string">"POST"</span>,<span class="string">"./getInfo"</span>,<span class="literal">true</span>);</span><br><span class="line">		request.setRequestHeader(<span class="string">"Content-Type"</span>,<span class="string">"application/x-www-form-urlencoded"</span>);</span><br><span class="line">		request.send(<span class="string">"name1=value1&amp;name2=value2&amp;name3=value3"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//回调函数  </span></span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">handler</span><span class="params">()</span></span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(request.readyState==<span class="number">4</span>)&#123;</span><br><span class="line">				<span class="keyword">if</span>(request.status&gt;=<span class="number">200</span>&amp;&amp;request.status&lt;<span class="number">300</span>||request.status==<span class="number">304</span>)&#123;</span><br><span class="line">					alert(request.resposeText);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;  </span><br><span class="line">	&#125;)();  </span><br><span class="line">```			 </span><br><span class="line">  </span><br><span class="line">### 使用post需要注意</span><br><span class="line">在使用post方式时，若直接通过send传入名值对传入参数，则服务器不能正常解析,这是由于使用post方式时传送的数据可以是多种类型的，服务器接收到数据后不知道以哪种数据类型进行解码。因此需要为请求指定头部信息`Content-Type`。使用get方式时不需要指定数据类型，这是由于get的数据是加在url里的，只能是文本格式。    </span><br><span class="line"></span><br><span class="line">- 解决方式一：设置请求头部信息    </span><br><span class="line">在调用open()之后，调用send()之前设置头部信息：  </span><br><span class="line">`request.setRequestHeader(<span class="string">"Content-Type"</span>,<span class="string">"application/x-www-form-urlencoded"</span>);`  </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">- 解决方式二：  XHR2级 使用FormData对象（IE9之前版本不支持）  </span><br><span class="line">FormData对象可以序列化表单，也可以创建与表单格式相同的数据  </span><br><span class="line">	- 方式一（创建与表单格式相同的数据）  </span><br><span class="line">	  </span><br><span class="line">```javascript </span><br><span class="line">			<span class="keyword">var</span> paras=<span class="keyword">new</span> FormData();</span><br><span class="line">			paras.append(<span class="string">"name1"</span>,<span class="string">"value1"</span>);</span><br><span class="line">			paras.append(<span class="string">"name2"</span>,<span class="string">"value2"</span>);  </span><br><span class="line">			request.send(paras);</span><br></pre></td></tr></table></figure></p>
<pre><code><span class="bullet">- </span>方式二（序列化表单）  
</code></pre><pre><code class="javascript"><span class="keyword">var</span> paras=<span class="keyword">new</span> FormData(<span class="built_in">document</span>.forms[<span class="number">0</span>]);
request.send(paras);
</code></pre>
<h3 id="get与post的比较">get与post的比较</h3><ul>
<li><p>用途<br>GET通常向服务器请求查询数据；无论GET多少次都不会改变服务器资源；<br>POST通常向服务器发送需要处理的数据；会改变服务器资源。  </p>
</li>
<li><p>参数数据发送过程<br>GET通过open()向服务器发送查询字符串，查询字符串就是url的一部分，且一般需要进行encodeURIComponent编码;<br>POST通过send()向服务器发送参数，参数跟着http消息发送。  </p>
</li>
<li><p>服务器获取参数数据的方式<br>使用GET时，由于参数时url的一部分所以只能是文本类型，服务器默认按照文本数据的方式解析；<br>在使用POST时，不只能发送纯文本，还能发送很多其他类型的数据，因此必须明确告诉服务器发送的是什么类型数据，这样服务器才能正确解码。需要设置XHR对象的请求头部信息”Content-Type”为”application/x-www-form-urlencoded”<br>测试了下，在C#下GET时服务器通过<code>Request.Params[&quot;name&quot;]</code>才能正确获取参数name的值；POST时服务器通过<code>Request.Form[&quot;name&quot;]</code>才能正确获取参数name的值。</p>
</li>
<li><p>数据量<br>GET 传送数据量较小，有长度限制。这是由于GET是将数据添加到URL中，而浏览器将URL的最大长度限制在2k；<br>POST 传送数据量是不受限的。  </p>
</li>
<li><p>安全性<br>POST要比GET安全，这是 由于：  </p>
<pre><code>-<span class="ruby"> <span class="constant">GET</span>的数据都是添加进<span class="constant">URL</span>,对所有人可见；<span class="constant">POST</span>的传送的数据是不可见的；  
</span>-<span class="ruby"> <span class="constant">GET</span>的数据能够被缓存，记录在历史记录里；<span class="constant">POST</span>的数据不能被缓存，不会留在浏览记录里。</span>
</code></pre></li>
<li><p>效率<br>POST比GET更加耗资源，效率较低，POST发送数据是分open()和send()两步进行的。  </p>
</li>
</ul>
<h2 id="ajax的原理和机制">ajax的原理和机制</h2><p>   从上述可以总结出使用AJAX发送一次请求的步骤： </p>
<ul>
<li>首先创建XHR对象（要考虑到浏览器的兼容性）；  </li>
<li>给该XHR对象绑定readystatechange事件；  </li>
<li>调用open方法，选择使用get还是post方式发送请求；</li>
<li>若选择get方式则将查询字符串写入url中（注意，参数需要编码）；</li>
<li>若选择post方式则使用send方法发送参数；  </li>
<li>在readystatechange事件处理程序中，判断请求对象的readystate和status属性，以便响应成功后进行处理。  </li>
<li>收到服务器的响应后，响应的数据会自动填充XHR对象的属性：  <ul>
<li>responseText,存放返回的文本，无论响应的内容是什么类型其内容都会保存在这个属性中  </li>
<li>responseXML，如果响应的内容类型是”text/xml”或”application/xml”，这个属性存放返回的包含响应数据的XML DOM文档；如果不是xml类型，该属性为null  </li>
<li>status，响应的http状态  </li>
<li>statusText,响应的http状态说明  </li>
</ul>
</li>
<li>js可以根据上述值做出处理。</li>
</ul>

          
        
      </div>
    

    
      <div class="post-footer">
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/03/20/hello-world/">
                Hello World
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2015-03-20
          
        </span>
        
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick_Start">Quick Start</h2><h3 id="Create_a_new_post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run_server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate_static_files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy_to_remote_sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      </div>
    

    
      <div class="post-footer">
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2014/10/04/2014-10-04-function-declare/">
                函数的声明
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2014-10-04
          
        </span>
        
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <h2 id="写在前面">写在前面</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f=<span class="function"><span class="keyword">function</span> <span class="title">myName</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//在这里获取的到myName吗</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//在这里获取的到myName吗</span></span><br></pre></td></tr></table></figure>
<p>看到这个问题的时候有些懵了，因此从来没有用这种方式定义过函数。<br>ps：事实上，最好不要用这种方式定义函数。不同浏览器下表现怪异。</p>
<h2 id="函数的定义方式">函数的定义方式</h2><p>函数的定义方式有三种：  </p>
<h3 id="函数声明">函数声明</h3><pre><code><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span></span>{}    
</code></pre><p>以前在写《作用域链和预处理》时，讲过当通过函数声明的方式定义函数时，会对函数体内的代码进行预处理，因此你可以在函数声明之前调用该函数。</p>
<h3 id="函数表达式">函数表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        alert(<span class="keyword">typeof</span> foo);<span class="comment">//在这里可以获取到foo</span></span><br><span class="line">    &#125;;</span><br><span class="line">    foo();    </span><br><span class="line">``` </span><br><span class="line">当通过函数表达式定义函数时，只是对于`<span class="keyword">var</span> foo`进行预处理，而不处理`<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;&#125;`内部代码。只有在执行阶段才处理`<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;&#125;`内部代码，因此以上定义必须在调用`foo`之前。  </span><br><span class="line">###  带有函数名称的函数表达式  </span><br><span class="line">```javascript   </span><br><span class="line">	<span class="keyword">var</span> foo=<span class="function"><span class="keyword">function</span> <span class="title">myName</span><span class="params">()</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;;   </span><br><span class="line">```	 </span><br><span class="line">**规范要求：**只能在`myName`函数体内部获取到`myName`，在函数体外部`myName`是无效的。但是在IE下则不同（IE对ECMAScript的实现总是不按规矩来）  </span><br><span class="line">####实例一：函数名是否渗透到外部作用域中 </span><br><span class="line">```javascript  </span><br><span class="line">	<span class="keyword">var</span> foo=<span class="function"><span class="keyword">function</span> <span class="title">myName</span><span class="params">()</span></span>&#123;</span><br><span class="line">		alert(<span class="keyword">typeof</span> myName);<span class="comment">//function</span></span><br><span class="line">	&#125;; </span><br><span class="line">	alert(<span class="keyword">typeof</span> myName);<span class="comment">//IE下返回function，其他浏览器返回undefined</span></span><br></pre></td></tr></table></figure>
<p>关于对上述代码的处理，我是这么理解的：  </p>
<ul>
<li><p>在IE下，预处理阶段对<code>function myName(){}</code>进行处理(<strong>当做函数声明来处理</strong>),将<code>myName</code>添加到作用域链中，因此在外部是可以访问<code>myName</code>的；在执行时将<code>myName</code>赋值给<code>foo</code>。通过以下代码可以证实：  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="keyword">typeof</span> myName);<span class="comment">//function</span></span><br><span class="line"><span class="keyword">var</span> foo=<span class="function"><span class="keyword">function</span> <span class="title">myName</span><span class="params">()</span></span>&#123;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在其他浏览器下，预处理阶段不会处理<code>function myName(){}</code>,执行到<code>var foo=function myName(){}</code>时将<code>myName</code>添加到作用域链中，但是该赋值语句执行完立即将<code>myName</code>从作用域链中删除，因此在外部无法访问到<code>myName</code>。  </p>
</li>
</ul>
<h4 id="实例二：两个对象是否相互影响">实例二：两个对象是否相互影响</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> <span class="title">myName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        alert(foo == myName);</span><br><span class="line">    &#125;;</span><br><span class="line">    foo();<span class="comment">//IE下返回false，其他浏览器下返回true  </span></span><br><span class="line">```  </span><br><span class="line">- IE下，`foo`和`myName`是两个独立的对象。   </span><br><span class="line"></span><br><span class="line">#### 实例三：在条件控制时使用哪种方式定义函数 </span><br><span class="line">```javascript  </span><br><span class="line">	 <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; alert(<span class="number">1</span>); &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; alert(<span class="number">2</span>); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    foo();</span><br></pre></td></tr></table></figure>
<p>上述代码再FF下返回1；在其他浏览器下返回2。<br>这是由于在FF下，使用函数声明定义函数时，在预处理阶段忽略声明，在<strong>执行阶段</strong>才进行声明。<br><strong>注意：</strong>从上述代码可知，最好不要再条件判断语句中使用函数声明，可以通过函数表达式进行函数定义。例如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">	 <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> foo=<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123; alert(<span class="number">1</span>); &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> foo=<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123; alert(<span class="number">2</span>); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    foo();<span class="comment">//1    </span></span><br><span class="line">```  </span><br><span class="line">## 总结和疑惑  </span><br><span class="line">**总结**：尽量避免使用类似于`<span class="keyword">var</span> foo=<span class="function"><span class="keyword">function</span> <span class="title">myName</span><span class="params">()</span></span>&#123;&#125;`这种方式的函数定义，在IE、FF下都会有诡异的行为。如果你想递归调用可以使用`<span class="built_in">arguments</span>.callee`。  </span><br><span class="line">另外，尽量避免在条件判断中使用函数声明，推荐使用函数表达式。  </span><br><span class="line">  </span><br><span class="line">**疑惑**：  </span><br><span class="line">```javascript  </span><br><span class="line">	<span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span> <span class="title">g</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        alert(<span class="number">1</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">false</span>) &#123;</span><br><span class="line">        f = <span class="function"><span class="keyword">function</span> <span class="title">g</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            alert(<span class="number">2</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">	g();<span class="comment">//非IE下报错（无法访问g），在IE下输出2</span></span><br><span class="line">    f();<span class="comment">//1</span></span><br></pre></td></tr></table></figure></p>
<p>以上代码在非IE浏览器下的输出很好理解，以为预处理阶段会忽略<code>function g(){}</code>。<br>但是对于<code>f()</code>在IE下仍输出1，没能理解。我努力试图理解了以下，不知道是不是准确： </p>
<ul>
<li>（IE下）在预处理阶段，由于忽略逻辑判断，<code>g</code>已经发生了变化；在执行阶段，重新创建了一个对象（类似于对<code>g</code>的深度拷贝），将该对象赋值给<code>f</code>，由于是深度拷贝所以<code>g</code>和<code>f</code>是两个互不影响的对象。  </li>
<li>而在非IE浏览器下，执行阶段直接将对象<code>g</code>赋值给了<code>f</code>，<code>g</code>和<code>f</code>是引用关系，相互影响。<br>上述也印证了示例二。</li>
</ul>

          
        
      </div>
    

    
      <div class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/JS/">
                #JS
              </a>
            
          </div>
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2014/09/26/2014-09-26-arguments/">
                函数之arguments
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2014-09-26
          
        </span>
        
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <h2 id="写在前面">写在前面</h2><p>你觉得<code>arguments</code>很简单吗？那想想这几个问题：  </p>
<ul>
<li>arguments是不是数组？  </li>
<li>arguments与命名参数如何相互影响的？  </li>
<li>命名参数是必须的吗？  </li>
<li>不定义命名参数可以传参吗能获取参数吗？  </li>
<li>命名参数个数与实参个数一定要一致吗？  </li>
<li>怎么知道定义了几个命名参数？  </li>
<li>怎么知道执行时实际传递了几个参数？    </li>
<li><code>arguments</code>的长度是由形参还是实参决定的？    </li>
</ul>
<p>按照惯例，结合例子分析清楚以上每一个点。  </p>
<h2 id="示例及要点分析">示例及要点分析</h2><h3 id="示例一:arguments的真身">示例一:arguments的真身</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span><span class="params">(para1,para2)</span></span>&#123;</span><br><span class="line">	alert(<span class="keyword">typeof</span> <span class="built_in">arguments</span>);<span class="comment">//object</span></span><br><span class="line">	alert(<span class="built_in">arguments</span> <span class="keyword">instanceof</span> <span class="built_in">Array</span>);<span class="comment">//false</span></span><br><span class="line">&#125;)(<span class="string">"a"</span>,<span class="string">"b"</span>);</span><br></pre></td></tr></table></figure>
<p>从上述可以看出<code>arguments</code>不是数组，<strong>它是一个对象</strong>，准确的说它是一个<strong>类数组对象！</strong>。这里穿插讲一下类数组对象：   </p>
<h4 id="类数组对象：">类数组对象：</h4><p>从字面意思来讲，就是一个对象它拥有的一些特性或行为跟数组很像。比如类数组对象拥有length属性、可以像遍历数组一样地来遍历类数组对象；<br>类数组对象归根结底是一个<strong>对象</strong>，它是Object的一个实例，而不是Array的实例；<br>由上可知，类数组对象不能调用大多数组的方法（join、slice、concat等）；  </p>
<h4 id="示例一解析：">示例一解析：</h4><p>可以将在上述例子中<code>arguments</code>的真身理解为下面这个类数组对象：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="number">0</span>:<span class="string">"a"</span>,<span class="number">1</span>:<span class="string">"b"</span>,length:<span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>当使用<code>arguments[0]</code>获取第一个实参时，其实<code>0</code>是作为对象的属性名存在的，而不应理解为数组中的索引值。这时候也许有人会问，能不能用<code>arguments.0</code>来获取属性<code>0</code>的值，答案是不能（会报错）。这是因为<strong>对于对象属性来说，当属性名是合法标识符（即字面、数组、下划线组成且首字符不能是数字）时，这两种获取属性值的方式都是可用的；而当属性名不是合法标识符时，只能通过<code>[]</code>来获取属性。</strong>  </p>
<p><strong>总结：</strong>其实归根结底牢记<code>arguments</code>是一个对象，它的特殊性在于一定拥有一个<code>length</code>属性，而且其他属性名都是数字。</p>
<hr>
<h3 id="实例二：形参与实参">实例二：形参与实参</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       alert(<span class="built_in">arguments</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    test1(<span class="number">1</span>);    </span><br><span class="line">  </span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">test2</span><span class="params">(para1,para2)</span> </span>&#123;</span><br><span class="line">       alert(<span class="built_in">arguments</span>[<span class="number">1</span>]);</span><br><span class="line">       alert(para2);</span><br><span class="line">	   alert(<span class="built_in">arguments</span>.length);</span><br><span class="line">   	&#125;</span><br><span class="line">    test2(<span class="number">1</span>); <span class="comment">//undefined、undefined、1</span></span><br><span class="line">	test2(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);<span class="comment">//2,2,3</span></span><br><span class="line"></span><br><span class="line">	alert(test1.length);<span class="comment">//0</span></span><br><span class="line">	alert(test2.length);<span class="comment">//2</span></span><br><span class="line">```      </span><br><span class="line">#### 示例分析：  </span><br><span class="line">从以上代码可以说明几点：    </span><br><span class="line"></span><br><span class="line">- 在js中函数的形参是可有可无的，形参只是提供便利，不是必须的。若没有定义形参,则在函数内部通过`<span class="built_in">arguments</span>`访问实参；    </span><br><span class="line">- 形参是作为函数的局部变量存在的；  </span><br><span class="line">- 可以通过`functionName.length`获取函数定义形参的个数；  </span><br><span class="line">- 可以通过`<span class="built_in">arguments</span>.length`获取函数传入实参的个数；  </span><br><span class="line">- 若传入实参个数少于形参个数，则多余的形参自动设为`<span class="literal">undefined</span>`；  </span><br><span class="line"></span><br><span class="line">### 实例三    </span><br><span class="line">```javascript  </span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">f</span><span class="params">(para1,para2)</span></span>&#123;</span><br><span class="line">		para1=<span class="string">"c"</span>;</span><br><span class="line">		alert(<span class="built_in">arguments</span>[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">arguments</span>[<span class="number">1</span>]=<span class="string">"d"</span>;  </span><br><span class="line">		alert(<span class="built_in">arguments</span>.length);<span class="comment">//执行Ⅰ</span></span><br><span class="line">		alert(para2);</span><br><span class="line">	&#125;</span><br><span class="line">	f(<span class="string">"a"</span>,<span class="string">"b"</span>);<span class="comment">//"c",2，"d"</span></span><br><span class="line">	f(<span class="string">"a"</span>);<span class="comment">//"c",1，undefined</span></span><br><span class="line">```  </span><br><span class="line">#### 实例分析：  </span><br><span class="line">从上述代码可以看出几点：  </span><br><span class="line">  </span><br><span class="line">- 参数和`<span class="built_in">arguments</span>`对象中对应的属性值是同步的，相互影响；  </span><br><span class="line">- 虽然值同步，但是参数和`<span class="built_in">arguments</span>`中属性是内存独立的；    </span><br><span class="line">- `<span class="built_in">arguments</span>`的长度`length`是由传入的实参个数确定的，而不是由形参个数确定的；这也是为什么`f(<span class="string">"a"</span>)`只传入一个参数时，即使`<span class="built_in">arguments</span>[<span class="number">1</span>]=<span class="string">"d"</span>`而`<span class="built_in">arguments</span>`的长度仍然只是<span class="number">1</span>且para2仍然为`<span class="literal">undefined</span>`。    </span><br><span class="line"></span><br><span class="line">#### 要点：着重讲一下`<span class="built_in">arguments</span>`的长度`length`是由传入的实参个数确定的，而不是由形参个数确定的。还是画图吧  </span><br><span class="line">![参数为DOM对象时jQuery对象内部结构](<span class="regexp">/images/</span><span class="built_in">arguments</span>.PNG) </span><br><span class="line"></span><br><span class="line">讲到这开头的那些疑问就全部解开了。下面写一个遇到的笔试题，跟`<span class="built_in">arguments</span>`有一点关系，不过重点还是在`<span class="keyword">this</span>`和作用域，决定找个时间好好写写`<span class="keyword">this</span>`，也请期待吧~  </span><br><span class="line">### 实例四</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line">bar: <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.baz; &#125;,</span><br><span class="line">baz: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">		alert(<span class="keyword">typeof</span> <span class="built_in">arguments</span>[<span class="number">0</span>]());</span><br><span class="line">&#125;)(foo.bar);</span><br></pre></td></tr></table></figure>
          
        
      </div>
    

    
      <div class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/JS/">
                #JS
              </a>
            
          </div>
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2014/09/25/2014-09-25-eval-scope-chain/">
                初探eval
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2014-09-25
          
        </span>
        
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <h2 id="写在前面">写在前面</h2><p>关于eval()，只在项目中对处理JSON数据时使用过，并没有具体研究过其工作原理。在面试中被寒冬问到，才发现自己根本不理解eval()。<br>这里主要将两点：1.eval()的用法；2.eval()与作用域相关</p>
<h2 id="eval()示例及要点分析">eval()示例及要点分析</h2><p>给几个例子，边感受边理解：  </p>
<h3 id="示例一">示例一</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">	alert(<span class="built_in">eval</span>(&#123; a: <span class="number">1</span>, b: <span class="number">2</span> &#125;));<span class="comment">//[object object]</span></span><br><span class="line">      	alert(<span class="built_in">eval</span>(<span class="string">"2+2"</span>));<span class="comment">//4</span></span><br><span class="line">      	alert(<span class="built_in">eval</span>(<span class="string">"function f()&#123;&#125;"</span>));<span class="comment">//undefined</span></span><br><span class="line">	alert(<span class="keyword">typeof</span> f);<span class="comment">//function</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>示例一分析：</strong>这个例子主要想说明<code>eval()</code>的参数以及返回值：      </p>
<ul>
<li>若参数不是字符串则直接返回该参数，例如上述代码中<code>eval({ a: 1, b: 2 })</code>就是直接返回对象；</li>
<li>若参数是字符串则直接执行字符串中代码，返回执行结果，例如上述代码<code>eval(&quot;2+2&quot;)</code>，表达式<code>2+2</code>返回值为4，因此eval()返回4；表达式<code>function f(){}</code>无返回值，因此<code>eval(&quot;function f(){}&quot;)</code>返回undefined。  </li>
</ul>
<h3 id="示例二">示例二</h3><pre><code><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">
    alert(<span class="built_in">eval</span>(<span class="string">"({a:1,b:2})"</span>));<span class="comment">//[object object]</span>
       alert(<span class="built_in">eval</span>(<span class="string">"{a:1,b:2}"</span>));<span class="comment">//出错</span>
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>   
</code></pre><p>这个例子看上去比较诡异，在项目中解析JSON数据是时用到过，当时不这么做<code>eval(&#39;(&#39;+jsonData+&#39;)&#39;)</code>就会出错。当时没有深究过为什么。<br><strong>示例二分析：</strong><br>你可以测试一下，在代码里直接执行<code>{a:1,b:2};</code>是会报错的，但是直接执行<code>({a:1,b:2});</code>则能够正常执行。这是因为分组操作符<code>()</code>会强迫解析器将<code>{}</code>当做对象字面量来解析，而不是将<code>{}</code>当做代码段来执行。<br><strong>PS：</strong><code>()</code>只能包含表达式，而不能包含语句。  </p>
<h3 id="示例二-1">示例二</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">         <span class="built_in">eval</span>(<span class="string">"alert(1);"</span>);</span><br><span class="line">     <span class="xml"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>这个没什么好分析的，就是简单的告诉你eval()的效果就是让其参数执行。</p>
<h3 id="示例二-2">示例二</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> test = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">"alert(test);"</span>);<span class="comment">//1</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>以上代码等价于：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">         <span class="keyword">var</span> test = <span class="number">1</span>;</span><br><span class="line">        alert(test);<span class="comment">//1</span></span><br><span class="line">     &lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="示例三">示例三</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> &lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">     <span class="built_in">eval</span>(<span class="string">"alert(test2);"</span>);<span class="comment">//undefined</span></span><br><span class="line">     <span class="keyword">var</span> test2 = <span class="number">1</span>;</span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>以上代码等价于<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">          alert(test2);</span><br><span class="line">          <span class="keyword">var</span> test2 = <span class="number">1</span>;</span><br><span class="line">     <span class="xml"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>由作用域链很容易就看懂输出undefined</p>
<h3 id="示例四">示例四</h3><pre><code class="javascript">&lt;script type=<span class="string">"text/javascript"</span>&gt;
    <span class="built_in">eval</span>(<span class="string">"var t=1;function f(){alert('hehe');}"</span>);
    alert(t);
    f();
<span class="xml"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span>
</code></pre>
<p>以上代码等价于    </p>
<pre><code class="javascript"> &lt;script type=<span class="string">"text/javascript"</span>&gt;
    <span class="keyword">var</span> t=<span class="number">1</span>;
    <span class="function"><span class="keyword">function</span> <span class="title">f</span><span class="params">()</span></span>{alert(<span class="string">'hehe'</span>);}
    alert(t);<span class="comment">//1</span>
    f();<span class="comment">//hehe</span>
&lt;<span class="regexp">/script&gt;</span>
</code></pre>
<p>不用解释了吧~</p>
<h3 id="示例五">示例五</h3><pre><code class="javascript">&lt;script type=<span class="string">"text/javascript"</span>&gt;
    alert(val);<span class="comment">//报错</span>
    <span class="built_in">eval</span>(<span class="string">"var val=1;"</span>);
<span class="xml"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span>
</code></pre>
<p><strong>示例分析：</strong><br>示例五还有讲一讲的必要，上述代码无法会报错，这是由于<strong>参数在预处理（解析）过程中只是作为一个字符串 ，只有在执行时才创建变量</strong>。也就是说在预处理时eval中的参数<code>var val=1;</code>并未被预处理，只是作为一个字符串存在。因此执行<code>alert(val)</code>时根本找不到<code>val</code>的声明。</p>

          
        
      </div>
    

    
      <div class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/JS/">
                #JS
              </a>
            
          </div>
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2014/09/24/2014-09-24-watch-scope-chain/">
                作用域链之try-catch
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2014-09-24
          
        </span>
        
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <h2 id="写在前面">写在前面</h2><p>之前写了关于作用域链之with，try-catch对于作用域链的影响比较类似，但是try-catch相对with的情况简单多了。<br>with、try-catch都可以延长作用域链，在当前作用域链的前端添加一个变量对象。<br>它们不同的是：    </p>
<ul>
<li><code>with(o){}</code>是在当前作用域链前端添加<strong>已有</strong>的变量对象o;  </li>
<li><code>try{} catch(o){}</code>是<strong>新创建</strong>变量对象o，然后添加到当前作用域链前端。  </li>
</ul>
<p>它们的共同点：  </p>
<ul>
<li><code>with</code>代码块和<code>catch</code>代码块内声明的变量都会添加到离它们最近的函数环境中去。  </li>
</ul>
<h3 id="try-catch在IE中的特殊表现">try-catch在IE中的特殊表现</h3><p><code>try{} catch(o){}</code>中捕获的错误对象o在非IE浏览器和IE9+中会添加到catch块的变量对象中，而在IE8-中会添加到离catch块最近的函数环境中去。结果就是：  </p>
<ul>
<li>在非IE浏览器、IE9中，在<code>catch{}</code>执行完后，变量对象o就被删除了（这点跟with很像），因此在<code>catch{}</code>外无法在访问到o；  </li>
<li>在IE8-中，在<code>catch{}</code>执行完成后，变量对象仍然是可以访问的。<br>具体表现可以看下面例子，我会画图~  </li>
</ul>
<h2 id="示例">示例</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">t</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> a = <span class="number">100</span>;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         alert(error);</span><br><span class="line">       &#125;</span><br><span class="line">      <span class="keyword">catch</span> (o) &#123;</span><br><span class="line">          alert(a);</span><br><span class="line">	   alert(<span class="keyword">typeof</span> o);<span class="comment">//执行Ⅰ</span></span><br><span class="line">          <span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line">	   <span class="keyword">var</span> b = <span class="number">0</span>;</span><br><span class="line">          alert(a);</span><br><span class="line">         </span><br><span class="line">      &#125;</span><br><span class="line">      alert(a);<span class="comment">//执行Ⅱ</span></span><br><span class="line">   alert(b);</span><br><span class="line">      alert(<span class="keyword">typeof</span> o);</span><br><span class="line">  &#125;</span><br><span class="line">  t(); <span class="comment">//非IE8-下：100、undefined、10、10、0、undefined</span></span><br><span class="line">	<span class="comment">//IE8-下：100、undefined、10、10、0、object</span></span><br></pre></td></tr></table></figure>
<p>作用域链分析图如下：<br><img src="/images/catch_scope_chain.PNG" alt="参数为DOM对象时jQuery对象内部结构">  </p>
<h3 id="想要说明的几点：">想要说明的几点：</h3><ul>
<li>例子中我写了<code>var b=0;</code>这个是为了验证catch(){}内声明的变量会添加到离他最近的执行环境中去；  </li>
<li>图3和图4可以看出IE8-跟标准的差别  </li>
</ul>
<p>困死了,明天写作用域链之eval.</p>

          
        
      </div>
    

    
      <div class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/JS/">
                #JS
              </a>
            
          </div>
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2014/09/24/2014-09-24-with-scope-chain/">
                作用域链之with
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2014-09-24
          
        </span>
        
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <h2 id="写在前面">写在前面</h2><p>之前总结过一篇关于“预编译”和作用域链的问题的总结，那个主要是针对Global和函数产生的作用域。后来在面试过程中被寒冬问道了with、try-catch、eval对作用域的影响，才发现对于这些“特殊”情况考虑的太少。今天就说说with吧，书上讲解的也不够全面（个人感觉主要原因是不推荐使用with吧）。<br>PS：由于js是解释型语言嘛，寒冬大大说“预编译”不算恰当，在下面就改成“预处理”~  </p>
<h2 id="由一个例子引出重要的点">由一个例子引出重要的点</h2><p>在js中并不是任何时候<code>{}</code>都会产生自己的作用域。比如说<code>for(){}、if(){}</code>不会产生自己的作用域，在他们内部声明的变量仍然是添加到包含他们的函数的作用域中，因此在<code>for(){}、if(){}</code>之外这些变量仍然是可访问的。     </p>
<p>一般是函数会产生作用域，但是<code>with(){}</code>也会对影响作用域链，准确的说是<strong>延长</strong>作用域链，<code>with(o){}</code>在代码<strong>执行</strong> 过程中在作用域链前端添加变量对象o，<strong>with代码执行</strong>完成后将该变量对象移除。  </p>
<h3 id="例子前的思考">例子前的思考</h3><p>我认为关于<code>with(o){}</code>需要思考的问题主要是三个：<strong>with代码块内变量的访问、with代码块内变量的赋值、with代码块内变量的声明</strong>。  </p>
<ul>
<li>代码块内变量的访问：分为两种情况，对o的属性的访问；对with外部环境中变量的访问。  </li>
<li>代码块内变量的声明：仍然分为两种情况，对o的属性的重复声明；对“新”变量的声明（这个新是相对于o来讲的，即不是o的属性）。   </li>
<li>代码块内变量的赋值：仍然分两种情况，对o的属性的赋值；对非o的属性的赋值。  <h3 id="实例一">实例一</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">var</span> val = &#123; a: <span class="number">1</span>, b: <span class="number">2</span> &#125;;</span><br><span class="line"> <span class="keyword">var</span> c = <span class="number">100</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">t</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> a = <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">var</span> e = <span class="number">100</span>;<span class="comment">//预编译㈠</span></span><br><span class="line">        <span class="keyword">with</span> (val) &#123;</span><br><span class="line">            alert(a);<span class="comment">//⑴</span></span><br><span class="line">   alert(c);<span class="comment">//执行Ⅰ //⑵</span></span><br><span class="line">            <span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">var</span> e = <span class="number">10</span>;<span class="comment">//预编译㈡</span></span><br><span class="line">   <span class="keyword">var</span> c = <span class="number">10</span>;</span><br><span class="line">   b = <span class="number">20</span>;   <span class="comment">//执行Ⅱ</span></span><br><span class="line">            alert(a);<span class="comment">//⑶</span></span><br><span class="line">        &#125;</span><br><span class="line">        alert(a);<span class="comment">//执行Ⅲ //⑷</span></span><br><span class="line">        alert(e);<span class="comment">//⑸</span></span><br><span class="line">        alert(val.a);<span class="comment">//⑹</span></span><br><span class="line">  alert(c);<span class="comment">//⑺</span></span><br><span class="line">    &#125;  </span><br><span class="line">t();<span class="comment">//1,undefined,10,100,10,10,10</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>注意1：</strong>with在代码<strong>执行</strong> 过程中在作用域链前端添加变量对象，<strong>代码执行</strong>后将该变量对象移除。<br><strong>注意2：</strong>在with代码段内声明的变量 <strong>不会添加为val的属性</strong>，只会添加到离with最近的函数环境中。</p>
<p>下面，我绘制了上述代码在不同阶段的作用域链的情况：<br><img src="/images/with_scope_chain.PNG" alt="参数为DOM对象时jQuery对象内部结构">  </p>
<p>由上图可以看出以下几点：<br><strong>关于预编译（with内变量的声明）：</strong>     </p>
<ul>
<li>预处理阶段不会将<code>with()</code>中的对象添加到作用域链前端，但是仍会对<code>with</code>的<code>{}</code>内代码段进行预处理。  </li>
<li>在预处理时在<code>with</code>的<code>{}</code>代码段内声明的变量会被添加到离他最近的函数环境中，这就是为什么c会在t()的环境中。  </li>
<li>预处理走到㈠时，声明a、e并将他们添加到t()的变量对象中去；走到㈡时再次将a、e添加到t()的变量对象中，由于对象中同名属性会覆盖，所以你看到的结果就如图1了~，需要注意的是在这个过程中对a、e的处理没有区别（即使a是val的属性，而e是新变量）      </li>
</ul>
<p><strong>关于with内赋值</strong>      </p>
<ul>
<li>执行到with时将val的变量对象添加到作用域链的前端，如图2  </li>
<li>给val的属性赋值：<br>在val的变量对象中搜索该属性，找到后进行赋值操作，然后就结束了，<strong>不会沿着作用域链向上找，将同名的变量均赋值</strong>。<br>例如，<code>var a=10;</code>进行赋值<code>a=10</code>时，在val的变量对象里找到a赋值为10，对于t()变量对象中的a不进行赋值操作（仍为100）。还有一点需要注意，window变量对象中val.a也发生了变化，对于这个我认为是由于对象是引用类型的。<br><code>var e=10；</code>对e进行赋值时，现在val的变量对象里搜索e，未找到，于是沿着作用域链向上搜索到t()的变量对象，找到e将其赋值为10。c也一样。<br>这就解释了：⑷弹出100而不是10；⑹弹出10而不是原来的1。  </li>
</ul>
<p><strong>关于with内变量的访问：</strong>  </p>
<ul>
<li>若在with内部访问变量，其搜索过程是这样的：在val的变量对象中搜索，找到就返回；找不到沿着作用域链向上找，直到找到返回。<br>例如，执行到⑴时在val内搜索a，找到，此时val内a的值为1（由图2可知），返回1；<br>执行到⑵在val内搜索c，未找到，沿着作用域链向上在t()内部变量搜索找到c，此时其值为undefined（由图2可知），返回undefined;<br>执行到⑶，在val内搜索a，找到，此时val内a的值已变为10（由图3）可知，返回10。  </li>
</ul>
<p><strong>with执行结束后变量的访问：</strong><br>上面已两次强调了，with执行结束后就将其添加的val变量对象删除，因此其作用域链会发生变化，执行到Ⅲ时作用域链如上述图4所示。<br>⑷⑸⑺均是在t()对象变量里搜索；<br>⑹在全局变量对象中搜索到val，此时val.a已变化。</p>
<h3 id="实例二">实例二</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> val = &#123; a: <span class="number">1</span>, b: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">t4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">var</span> a = <span class="number">1000</span>;</span><br><span class="line">       <span class="keyword">with</span> (val) &#123;</span><br><span class="line">           alert(a);</span><br><span class="line">           <span class="keyword">var</span> a;</span><br><span class="line">       &#125;</span><br><span class="line">       alert(a);</span><br><span class="line">   &#125;</span><br><span class="line">t4();<span class="comment">//1,1000</span></span><br></pre></td></tr></table></figure>
<h3 id="实例三">实例三</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> val = &#123; a: <span class="number">1</span>, b: <span class="number">2</span> &#125;;</span><br><span class="line">   <span class="keyword">var</span> d=<span class="number">0</span>;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">t5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">with</span> (val) &#123;</span><br><span class="line">           alert(d);</span><br><span class="line">           <span class="keyword">var</span> d = <span class="number">10</span>;</span><br><span class="line">           alert(d);</span><br><span class="line">       &#125;</span><br><span class="line">       alert(d);</span><br><span class="line">   &#125;</span><br><span class="line">   t5();<span class="comment">//undefined、10,10,0</span></span><br><span class="line">   alert(d);</span><br></pre></td></tr></table></figure>
<p>其实示例一已经完全足够了.<br>ps:搞了2天才搞到这个程度, 接下来开始总结try-catch、eval对作用域的影响,敬请期待啦！</p>

          
        
      </div>
    

    
      <div class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/JS/">
                #JS
              </a>
            
          </div>
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2014/09/16/2014-09-16-event-flow/">
                js中事件流
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2014-09-16
          
        </span>
        
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <h2 id="DOM事件流">DOM事件流</h2><p>“DOM2级事件”规定，事件流包括三个阶段：捕获阶段、目标阶段和冒泡阶段。<br>话不多说，举例子说明事件触发顺序。  </p>
<h2 id="实例说明">实例说明</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">       <span class="xml"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"container"</span> <span class="attribute">id</span>=<span class="value">"container"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"test"</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>上述代码文档结构如下图所示：<br><img src="/images/eventflow.PNG" alt="参数为DOM对象时jQuery对象内部结构">    </p>
<h3 id="添加事件处理程序：">添加事件处理程序：</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">          <span class="keyword">var</span> test = <span class="built_in">document</span>.getElementById(<span class="string">"test"</span>);</span><br><span class="line">          <span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">"container"</span>);</span><br><span class="line">	</span><br><span class="line">		<span class="comment">//给test添加click事件，设置在“冒泡”阶段调用</span></span><br><span class="line">          test.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">              alert(<span class="string">"test冒泡"</span>);</span><br><span class="line">          &#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//给test添加click事件，设置在“捕获”阶段调用</span></span><br><span class="line">          test.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">              alert(<span class="string">"test捕获"</span>);</span><br><span class="line">          &#125;, <span class="literal">true</span>);</span><br><span class="line">          </span><br><span class="line">		<span class="comment">//给container添加click事件，设置在“捕获”阶段调用</span></span><br><span class="line">          container.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">              alert(<span class="string">"container捕获"</span>);</span><br><span class="line">          &#125;, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">////给container添加click事件，设置在“冒泡”阶段调用</span></span><br><span class="line">          container.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">              alert(<span class="string">"container冒泡"</span>);</span><br><span class="line">          &#125;, <span class="literal">false</span>);</span><br><span class="line">          </span><br><span class="line"></span><br><span class="line">		<span class="comment">//给body添加click事件，设置在"冒泡"阶段调用</span></span><br><span class="line">          <span class="built_in">document</span>.body.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">              alert(<span class="string">"body"</span>);</span><br><span class="line">          &#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//给docum添加click事件，设置在"冒泡"阶段调用</span></span><br><span class="line">          <span class="built_in">document</span>.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">              alert(<span class="string">"document"</span>);</span><br><span class="line">          &#125;, <span class="literal">false</span>);</span><br><span class="line">    <span class="xml"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>当点击上图中的1时，事件的触发顺序如下图所示：<br><img src="../images/eventflow1.PNG" alt="参数为DOM对象时jQuery对象内部结构">   </p>
<p>1，2，3指的是设置为在捕获阶段调用的click事件；4和5是目标元素上的click事件，至于先触发捕获还是先触发冒泡，这决定于先绑定的是冒泡还是捕获，4指的是先绑定的那个；6,7,8指的是设置为在冒泡阶段调用的click事件。    </p>
<p>根据上述js代码，可以得到点击1时的输出顺序：<br>弹出”container捕获”（这是由于document、body上没有捕获阶段的click事件）——》弹出”test冒泡”——》弹出”test捕获”（这是由于在目标元素上捕获定义在了冒泡后面）——》弹出”container冒泡”——》弹出“body”——》弹出“document”。</p>
<p><strong>ps：</strong>在关注事件流时，我们上图只包含了目标元素test与它的祖先元素们，而与test的子孙元素无关。即当我们点击上图中的2时，目标元素时container，这时候是不用考虑test元素的。 </p>

          
        
      </div>
    

    
      <div class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/JS/">
                #JS
              </a>
            
          </div>
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2014/09/11/2014-09-11-colums/">
                使高度不定的列等高
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2014-09-11
          
        </span>
        
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <h2 id="想要达到的效果">想要达到的效果</h2><p>注意：难点在于这些列高度是可变的，不固定的。<br><img src="../images/equal_height6.PNG" alt="参数为DOM对象时jQuery对象内部结构"><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"wrapper"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"box"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">h1</span>&gt;</span>《赤裸裸》<span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">p</span>&gt;</span></span><br><span class="line">           郑钧这张专辑主要面对的听众层是从18岁到30岁之间，其中包括高中生、大学生、以及走出校门步入社会时间不久的年轻人，正是这一代人中十分典型的心态。郑钧把他这份真实的感受，大胆质朴地流露在他的音乐中，相信会在年轻人中间产生强烈的共鸣。</span><br><span class="line">       <span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"box"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">h1</span>&gt;</span>郑钧简历<span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">p</span>&gt;</span></span><br><span class="line">           1987年就读于杭州电子工业学院工业外贸专业，期间由于专业的影响接触了大量欧美摇滚乐，并开始最初的音乐创作。在校期间自己组建了一支乐队"火药"，并曾于杭州各高校间巡演受到热列欢迎。 </span><br><span class="line">           1992年开始了他的职业歌手生涯, 签约香港红星唱片公司。 </span><br><span class="line">           1994年6月发行首张个人专辑《赤裸裸》，十首歌曲全部由郑钧独自作词作曲并演唱。 专辑正版发行量超过五十万张，而据有据可查的盗版数量至少在一百五十万，是当年个人专辑发行量最高的歌手。其中《回到拉萨》、《赤裸裸》、《极乐世界》、《灰姑娘》、等作品今在国内广为流传。《回到拉萨》一曲曾创下了连续七周冠军、二十二周不下榜的记录，成为九四年中国乐坛的经典曲目。 </span><br><span class="line">           2000年10月 应邀参加TOSHIBA EMI “MUSIC TALKS” 现场表演轰动日本媒体和唱片界，成为全场焦点。 </span><br><span class="line">           2001年春 签约久负盛名的EMI唱片公司，成为百代中国首位内地巨星。 </span><br><span class="line">           2001年12月 加盟EMI后第一张个人专辑《郑钧》正式发行。 </span><br><span class="line">           2003年12月 《我们的生活》——充满阳光 <span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">   <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"box"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">h1</span>&gt;</span>主要奖项<span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">p</span>&gt;</span>1994年 《赤裸裸》获得了：94年中南十大金曲；94年广州十大金曲等数 十个奖项，他本人亦荣获北京"辉煌94"风云人物奖 </span><br><span class="line">           1996年 《赤裸裸》的ＭＴＶ保加利亚音乐节获音乐电视金奖；上海东方 电视台最佳MTV奖，本曲还曾获得过上海东方电视台的"群星耀东方"十大金曲、上海电台"茂盛杯"金曲奖，和96中国流行乐坛十年回顾"十年成就"奖。 </span><br><span class="line">           2002年6月 专辑《郑钧》荣获首届由中国音像协会主办的“中国唱片金碟奖”两大主力奖项：“最佳流行专辑奖”和“最佳摇滚专辑奖”。 </span><br><span class="line">     	<span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<h2 id="分步实现过程">分步实现过程</h2><h3 id="浮动形成3列">浮动形成3列</h3><p>在实现过程中，我会给元素添加边框，这样便于理解，完成后会将边框去掉<br>添加内边距和外边距，优化视觉效果<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.wrapper</span><br><span class="line">   &#123;</span><br><span class="line">     width:<span class="number">100</span>%;</span><br><span class="line">     border:<span class="number">1</span>px solid red;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">.box</span><br><span class="line">   &#123;</span><br><span class="line">       width:<span class="number">300</span>px;</span><br><span class="line">       float:left;</span><br><span class="line">       padding:<span class="number">20</span>px;</span><br><span class="line">       margin-left:<span class="number">20</span>px;</span><br><span class="line">       border:<span class="number">1</span>px solid #ccc;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/images/equal_height1.PNG" alt="参数为DOM对象时jQuery对象内部结构"></p>
<h3 id="清除浮动使父容器被撑开">清除浮动使父容器被撑开</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">	.wrapper:after</span><br><span class="line">    &#123;</span><br><span class="line">       content:<span class="string">"."</span>;</span><br><span class="line">       display:block;</span><br><span class="line">       clear:both;</span><br><span class="line">       height:<span class="number">0</span>;</span><br><span class="line">       visibility:hidden;</span><br><span class="line">        &#125;  </span><br><span class="line">```  </span><br><span class="line">![参数为DOM对象时jQuery对象内部结构](<span class="regexp">/images/</span>equal_height3.PNG)   </span><br><span class="line">### 关键步骤：使外边距和内边距抵消  </span><br><span class="line">给每个列添加大的底部内边距，将父容器撑大到一个很大的高度，    </span><br><span class="line">```javascript </span><br><span class="line">	.box</span><br><span class="line">    &#123;</span><br><span class="line">        width:<span class="number">300</span>px;</span><br><span class="line">        float:left;</span><br><span class="line">        padding:<span class="number">20</span>px;</span><br><span class="line">        margin-left:<span class="number">20</span>px;</span><br><span class="line">        border:<span class="number">1</span>px solid #ccc;</span><br><span class="line">        padding-bottom:<span class="number">300</span>px;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p><img src="images/equal_height2.PNG" alt="参数为DOM对象时jQuery对象内部结构"><br>然后再使用数值相近的负外边距，这样使每个列有一部分溢出<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.box</span><br><span class="line">   &#123;</span><br><span class="line">       width:<span class="number">300</span>px;</span><br><span class="line">       float:left;</span><br><span class="line">       padding:<span class="number">20</span>px;</span><br><span class="line">       margin-left:<span class="number">20</span>px;</span><br><span class="line">       border:<span class="number">1</span>px solid #ccc;</span><br><span class="line">       padding-bottom:<span class="number">300</span>px;</span><br><span class="line">       margin-bottom:-<span class="number">280</span>px;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/images/equal_height4.PNG" alt="参数为DOM对象时jQuery对象内部结构"> </p>
<h3 id="截断">截断</h3><p>再对父容器设置<code>overflow:auto</code>就将参差不齐的溢出部分截断，使它们高度相同<br>注意上面我设置的内边距为300，外边距为-280，这是为了使截断后，每个列还有20的内边距，视觉效果比较好。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.wrapper</span><br><span class="line">  &#123;</span><br><span class="line">    width:<span class="number">100</span>%;</span><br><span class="line">    border:<span class="number">1</span>px solid red;</span><br><span class="line">    overflow:auto;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="../images/equal_height5.PNG" alt="参数为DOM对象时jQuery对象内部结构"> </p>
<h3 id="设置颜色去除边框">设置颜色去除边框</h3><p><img src="../images/equal_height6.PNG" alt="参数为DOM对象时jQuery对象内部结构"> </p>
<h3 id="说明">说明</h3><p>在清除浮动时我使用了伪类，其实<code>overflow:auto</code>也能够清除浮动撑开父元素，但是在这个例子中我使用伪类就是想说明此时<code>overflow:auto</code>的最主要任务是截断。  </p>

          
        
      </div>
    

    
      <div class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/CSS/">
                #CSS
              </a>
            
          </div>
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2014/09/07/2014-09-07-canvas1/">
                用canvas绘制小图标
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2014-09-07
          
        </span>
        
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <h2 id="写在前面">写在前面</h2><p>刚看了canvas，于是用最基本的几个函数绘制了几个图标。这些图标是<code>Raphael.js</code>设计的，<code>Raphael.js</code>用自己的接口绘制了矢量的图标。没事儿就用canvas实现了一遍，今天只绘制了6个，图标如下：    </p>
<p><img src="../images/canvas1.PNG" alt="参数为DOM对象时jQuery对象内部结构">    </p>
<h2 id="实现代码：">实现代码：</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">  &lt;body&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="title">canvas</span> <span class="attribute">id</span>=<span class="value">"canvas1"</span> <span class="attribute">width</span>=<span class="value">"30"</span> <span class="attribute">height</span>=<span class="value">"30"</span> <span class="attribute">style</span>=<span class="value">"border:1px solid #ccc;"</span>&gt;</span><span class="tag">&lt;/<span class="title">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">canvas</span> <span class="attribute">id</span>=<span class="value">"canvas2"</span> <span class="attribute">width</span>=<span class="value">"30"</span> <span class="attribute">height</span>=<span class="value">"30"</span> <span class="attribute">style</span>=<span class="value">"border:1px solid #ccc;"</span>&gt;</span><span class="tag">&lt;/<span class="title">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">canvas</span> <span class="attribute">id</span>=<span class="value">"canvas3"</span> <span class="attribute">width</span>=<span class="value">"30"</span> <span class="attribute">height</span>=<span class="value">"30"</span> <span class="attribute">style</span>=<span class="value">"border:1px solid #ccc;"</span>&gt;</span><span class="tag">&lt;/<span class="title">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">canvas</span> <span class="attribute">id</span>=<span class="value">"canvas4"</span> <span class="attribute">width</span>=<span class="value">"30"</span> <span class="attribute">height</span>=<span class="value">"30"</span> <span class="attribute">style</span>=<span class="value">"border:1px solid #ccc;"</span>&gt;</span><span class="tag">&lt;/<span class="title">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">canvas</span> <span class="attribute">id</span>=<span class="value">"canvas5"</span> <span class="attribute">width</span>=<span class="value">"30"</span> <span class="attribute">height</span>=<span class="value">"30"</span> <span class="attribute">style</span>=<span class="value">"border:1px solid #ccc;"</span>&gt;</span><span class="tag">&lt;/<span class="title">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">canvas</span> <span class="attribute">id</span>=<span class="value">"canvas6"</span> <span class="attribute">width</span>=<span class="value">"30"</span> <span class="attribute">height</span>=<span class="value">"30"</span> <span class="attribute">style</span>=<span class="value">"border:1px solid #ccc;"</span>&gt;</span><span class="tag">&lt;/<span class="title">canvas</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript"></span><br><span class="line">    <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas1"</span>);</span><br><span class="line">        <span class="keyword">var</span> context = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.moveTo(<span class="number">5.5</span>, <span class="number">15.499</span>);</span><br><span class="line">        context.lineTo(<span class="number">15.8</span>, <span class="number">21.447</span>);</span><br><span class="line">        context.lineTo(<span class="number">15.8</span>, <span class="number">15.846</span>);</span><br><span class="line">        context.lineTo(<span class="number">25.5</span>, <span class="number">21.447</span>);</span><br><span class="line">        context.lineTo(<span class="number">25.5</span>, <span class="number">9.552</span>);</span><br><span class="line">        context.lineTo(<span class="number">15.8</span>, <span class="number">15.152</span>);</span><br><span class="line">        context.lineTo(<span class="number">15.8</span>, <span class="number">9.552</span>);</span><br><span class="line">        context.lineTo(<span class="number">5.5</span>, <span class="number">15.499</span>);</span><br><span class="line">        context.fill();</span><br><span class="line">        context.closePath();</span><br><span class="line">        <span class="comment">////////////////////////////////////////////////////////////////</span></span><br><span class="line">        <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas2"</span>);</span><br><span class="line">        <span class="keyword">var</span> context = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.moveTo(<span class="number">15.834</span>, <span class="number">29.084</span>);</span><br><span class="line">        context.lineTo(<span class="number">15.834</span>, <span class="number">16.166</span>);</span><br><span class="line">        context.lineTo(<span class="number">2.917</span>, <span class="number">16.166</span>);</span><br><span class="line">        context.lineTo(<span class="number">29.083</span>, <span class="number">2.917</span>);</span><br><span class="line">        context.fill();</span><br><span class="line">        context.closePath();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">///////////////////////////////////////////////////////////////////////</span></span><br><span class="line">        <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas3"</span>);</span><br><span class="line">        <span class="keyword">var</span> context = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line">        context.fillRect(<span class="number">1</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">15</span>);</span><br><span class="line">        context.fillRect(<span class="number">11</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">27</span>);</span><br><span class="line">        context.fillRect(<span class="number">21</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">20</span>);</span><br><span class="line">        <span class="comment">///////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">        <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas4"</span>);</span><br><span class="line">        <span class="keyword">var</span> context = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.arc(<span class="number">0</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI / <span class="number">2</span>, <span class="literal">true</span>);</span><br><span class="line">        context.closePath();</span><br><span class="line">        context.fill();</span><br><span class="line"></span><br><span class="line">        context.fillStyle = <span class="string">"#fff"</span>;</span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.arc(<span class="number">0</span>, <span class="number">30</span>, <span class="number">25</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI / <span class="number">2</span>, <span class="literal">true</span>);</span><br><span class="line">        context.closePath();</span><br><span class="line">        context.fill();</span><br><span class="line"></span><br><span class="line">        context.fillStyle = <span class="string">"#000"</span>;</span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.arc(<span class="number">0</span>, <span class="number">30</span>, <span class="number">20</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI / <span class="number">2</span>, <span class="literal">true</span>);</span><br><span class="line">        context.closePath();</span><br><span class="line">        context.fill();</span><br><span class="line"></span><br><span class="line">        context.fillStyle = <span class="string">"#fff"</span>;</span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.arc(<span class="number">0</span>, <span class="number">30</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI / <span class="number">2</span>, <span class="literal">true</span>);</span><br><span class="line">        context.closePath();</span><br><span class="line">        context.fill();</span><br><span class="line"></span><br><span class="line">        context.fillStyle = <span class="string">"#000"</span>;</span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.arc(<span class="number">5</span>, <span class="number">25</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>, <span class="literal">true</span>);</span><br><span class="line">        context.fill();</span><br><span class="line">        <span class="comment">////////////////////////////////////////////////////</span></span><br><span class="line">        <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas5"</span>);</span><br><span class="line">        <span class="keyword">var</span> context = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.arc(<span class="number">15</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI, <span class="literal">true</span>);</span><br><span class="line">        context.closePath();</span><br><span class="line">        context.fill();</span><br><span class="line"></span><br><span class="line">        context.fillRect(<span class="number">14</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.arc(<span class="number">15</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI, <span class="literal">true</span>);</span><br><span class="line">        context.closePath();</span><br><span class="line">        context.fill();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.fillStyle = <span class="string">"#fff"</span>;</span><br><span class="line">        context.arc(<span class="number">6</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI, <span class="literal">true</span>);</span><br><span class="line">        context.arc(<span class="number">12</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI, <span class="literal">true</span>);</span><br><span class="line">        context.arc(<span class="number">18</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI, <span class="literal">true</span>);</span><br><span class="line">        context.arc(<span class="number">24</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI, <span class="literal">true</span>);</span><br><span class="line">        context.closePath();</span><br><span class="line">        context.fill();</span><br><span class="line"></span><br><span class="line">        context.fillStyle = <span class="string">"#000"</span>;</span><br><span class="line">        context.fillRect(<span class="number">14</span>, <span class="number">16</span>, <span class="number">2</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.fillStyle = <span class="string">"#000"</span>;</span><br><span class="line">        context.arc(<span class="number">12</span>, <span class="number">26</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI, <span class="literal">false</span>);</span><br><span class="line">        context.closePath();</span><br><span class="line">        context.fill();</span><br><span class="line"></span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.fillStyle = <span class="string">"#fff"</span>;</span><br><span class="line">        context.arc(<span class="number">12</span>, <span class="number">26</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI, <span class="literal">false</span>);</span><br><span class="line">        context.closePath();</span><br><span class="line">        context.fill();</span><br><span class="line">        <span class="comment">////////////////////////////////////////////////////</span></span><br><span class="line">        <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas6"</span>);</span><br><span class="line">        <span class="keyword">var</span> context = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.arc(<span class="number">15</span>, <span class="number">15</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">2</span> * <span class="built_in">Math</span>.PI, <span class="literal">false</span>);</span><br><span class="line">        context.closePath();</span><br><span class="line">        context.fill();</span><br><span class="line"></span><br><span class="line">        context.fillStyle = <span class="string">"#fff"</span>;</span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.moveTo(<span class="number">15</span>, <span class="number">6</span>);</span><br><span class="line">        context.lineTo(<span class="number">19</span>, <span class="number">6</span>);</span><br><span class="line">        context.lineTo(<span class="number">19</span>, <span class="number">13</span>);</span><br><span class="line">        context.lineTo(<span class="number">23</span>, <span class="number">13</span>);</span><br><span class="line">        context.lineTo(<span class="number">15</span>, <span class="number">19</span>);</span><br><span class="line">        context.lineTo(<span class="number">7</span>, <span class="number">13</span>);</span><br><span class="line">        context.lineTo(<span class="number">11</span>, <span class="number">13</span>);</span><br><span class="line">        context.lineTo(<span class="number">11</span>, <span class="number">6</span>);</span><br><span class="line">        context.closePath();</span><br><span class="line">        context.fill();</span><br><span class="line"></span><br><span class="line">        context.beginPath();</span><br><span class="line">        context.translate(<span class="number">15</span>, <span class="number">24</span>);</span><br><span class="line">        context.arc(<span class="number">0</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">2</span> * <span class="built_in">Math</span>.PI, <span class="literal">false</span>);</span><br><span class="line">        context.closePath();</span><br><span class="line">        context.fill();</span><br><span class="line"></span><br><span class="line">        <span class="comment">///////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
          
        
      </div>
    

    
      <div class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/canvas/">
                #canvas
              </a>
            
          </div>
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  

          </div>

          
            <div class="pagination">
              <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">&raquo;</a>
            </div>
          
        </div>

        
<div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>

<div id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    

    <div class="site-overview">
      <div class="site-author motion-element">
        <img class="site-author-image" src="/images/default_avatar.jpg" alt="John Doe" />
        <p class="site-author-name">John Doe</p>
      </div>
      <p class="site-description motion-element"></p>
      <div class="site-state motion-element">
        <div class="site-state-item site-state-posts">
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">日志</span>
        </div>
        <div class="site-state-item site-state-tags">
            <span class="site-state-item-count">4</span>
            <span class="site-state-item-name">标签</span>
        </div>
        <div class="site-state-item site-state-pages">
            <span class="site-state-item-count">1</span>
            <span class="site-state-item-name">页面</span>
        </div>
      </div>

      

      <div class="social-info motion-element">
        
      </div>

      
      

    </div>

    

  </div>
</div>


      </div>
    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp; 
  2015
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">John Doe</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT</a>
</div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $(".fancybox").fancybox();
    });
  </script>

  <script type="text/javascript">
  function hasMobileUA () {
    var nav = window.navigator;
    var ua = nav.userAgent;
    var pa = /iPad|iPhone|Android|Opera Mini|BlackBerry|webOS|UCWEB|Blazer|PSP|IEMobile|Symbian/g;

    return pa.test(ua);
  }

  function isDesktop () {
    return screen.width > 991 && !hasMobileUA();
  }

  function isTablet () {
    return screen.width < 992 && screen.width > 767 && hasMobileUA();
  }

  function isMobile () {
    return screen.width < 767 && hasMobileUA();
  }

  function escapeSelector (selector) {
    return selector.replace(/[!"$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g, "\\$&")
  }
</script>

  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  
  <script type="text/javascript" id="motion.page.home">
    $(document).ready(function () {
      $.Velocity.RunSequence([
        { e: $('.brand'), p: { opacity: 1 }, o: { duration: 100 } },
        { e: $('.logo'), p: { opacity: 1, top: 0 }, o: { duration: 50} },
        { e: $('.site-title'), p: { opacity: 1, top: 0 }, o: { duration: 200, sequenceQueue: false } }
      ]);
      $('.menu-item').velocity('transition.slideDownIn', {display: null});
    });
  </script>


  <script type="text/javascript" id="motion.global">
  $(document).ready(function () {
    var body = $('body');
    var isSidebarVisible = false;
    var sidebarToggle = $('.sidebar-toggle');
    var sidebarToggleLine1st = $('.sidebar-toggle-line-first')
    var sidebarToggleLine2nd = $('.sidebar-toggle-line-middle');
    var sidebarToggleLine3rd = $('.sidebar-toggle-line-last');
    var sidebar = $('.sidebar');

    var SIDEBAR_WIDTH = '320px';
    var SIDEBAR_DISPLAY_DURATION = 300;

    var sidebarToogleLineStatusInit = {width: '100%', opacity: 1, left: 0, rotateZ: 0, top: 0};

    var sidebarToggleLine1stStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine1stStatusArrow = {width: '50%', rotateZ: '-45deg', top: '2px'};
    var sidebarToogleLine1stStatusClose = {width: '100%', rotateZ: '-45deg', top: '5px'};

    var sidebarToggleLine2ndStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine2ndStatusArrow = {width: '90%'};
    var sidebarToogleLine2ndStatusClose = {opacity: 0};

    var sidebarToggleLine3rdStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine3rdStatusArrow = {width: '50%', rotateZ: '45deg', top: '-2px'};
    var sidebarToogleLine3rdStatusClose = {width: '100%', rotateZ: '45deg', top: '-5px'};

    sidebatToggleMotion();
    postsListMotion();
    backToTopMotion();


    $(document)
      .on('sidebar.isShowing', function () {
        isDesktop() && body.velocity(
          {paddingRight: SIDEBAR_WIDTH},
          SIDEBAR_DISPLAY_DURATION
        );
        sidebarContentMotion();
      })
      .on('sidebar.isHiding', function () {});


    function backToTopMotion () {
      var b2top = $('.back-to-top');
      b2top.on('click', function () {
        body.velocity('scroll');
      });
    }

    function sidebarShowMotion () {

      sidebarToggleLine1st.velocity(sidebarToogleLine1stStatusClose);
      sidebarToggleLine2nd.velocity(sidebarToogleLine2ndStatusClose);
      sidebarToggleLine3rd.velocity(sidebarToogleLine3rdStatusClose);

      sidebar.velocity({width: SIDEBAR_WIDTH}, {
        display: 'block',
        duration: SIDEBAR_DISPLAY_DURATION,
        complete: function () {
          sidebar.addClass('sidebar-active');
          sidebar.trigger('sidebar.didShow');
        }
      });
      sidebar.trigger('sidebar.isShowing');
    }

    function sidebarHideMotion () {
      isDesktop() && body.velocity({paddingRight: 0});
      sidebar.velocity('reverse');

      sidebarToggleLine1st.velocity(sidebarToggleLine1stStatusInit);
      sidebarToggleLine2nd.velocity(sidebarToggleLine2ndStatusInit);
      sidebarToggleLine3rd.velocity(sidebarToggleLine3rdStatusInit);

      sidebar.removeClass('sidebar-active');
      sidebar.trigger('sidebar.isHiding');
    };

    function sidebarContentMotion () {
      $('.sidebar .motion-element').velocity(
        'transition.slideRightIn',
        {stagger: 50, drag: true}
      );
    }

    function postsListMotion () {
      var postMotionOptions = postMotionOptions || {stagger: 300, drag: true};
      $('.post').velocity('transition.slideDownIn', postMotionOptions);
    }

    function sidebatToggleMotion () {
      sidebarToggle.on('click', function () {
        isSidebarVisible ? sidebarHideMotion() : sidebarShowMotion();
        isSidebarVisible = !isSidebarVisible;
      });

      sidebarToggle.hover(function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusArrow);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusArrow);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusArrow);
      }, function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusInit);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusInit);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusInit);
      });
    }
  });

</script>





  

  

  
  

  


  
</body>
</html>
